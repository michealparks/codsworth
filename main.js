const e={db:void 0,open:async function(e,o,i){const n=window.indexedDB.open(e,o);n.onupgradeneeded=i,this.db=await t(n)},get:async function(e,o){return t(this.db.transaction(e).objectStore(e).get(o))},put:async function(e,o){return t(this.db.transaction(e,"readwrite").objectStore(e).put({...o,created:(new Date).getTime()}))},getAll:async function(e){return t(this.db.transaction(e).objectStore(e).getAll())},remove:async function(e,o){return t(this.db.transaction(e,"readwrite").objectStore(e).delete(o))},destroy:async function(e){return t(this.db.transaction(e,"readwrite").objectStore(e).clear())}};function t(e){return new Promise(function(t){function o({target:i}){t(i.result),e.removeEventListener("success",o),e.removeEventListener("error",o),e.removeEventListener("abort",o)}e.addEventListener("success",o),e.addEventListener("error",o),e.addEventListener("abort",o)})}function o(e,t){const o={state:t,reducer:e,subscribe:function(e){o.subscribers.push(e)},unsubscribe:function(e){o.subscribers.splice(o.subscribers.indexOf(e),1)},subscribers:[],dispatch:function(t){o.state=e(o.state,t),o.subscribers.forEach(function(e){e(o.state)})}};return o}const i=o(function(e,t){switch(t.type){case"ADD_ARTOBJECT":return t.artObject;default:return e}}),n=o(function(e,t){switch(t.type){case"ADD_ARTOBJECTS":return t.artObjects;default:return e}});async function r(...e){const t=await Promise.race([(o=1e4,new Promise(function(e){setTimeout(function(){e()},o)})),window.fetch(...e)]);var o;if(t)return t.status>=200&&t.status<300?t:void 0}i.subscribe(async function(t){e.put("images",t)}),n.subscribe(async function(t){e.put("artObjects",t)});const a={randomArtObject:async function(){const t=await async function(){const t=await e.get("artObjects","wikipedia");if(t&&t.artObjects.length>0)return t.artObjects;{const[e,t]=await async function(e){try{const t=await r(`https://en.wikipedia.org/w/api.php?action=parse&prop=text&page=${e}&format=json&origin=*`);return t?[void 0,(await t.json()).parse.text["*"]]:[!0]}catch(e){return console.error(e),[!0]}}("Wikipedia:Featured_pictures/Artwork/Paintings");if(e)return;const o=function(e){const t=(new DOMParser).parseFromString(e,"text/html");return Array.from(t.querySelectorAll(".gallerybox")).map(function(e){const t=e.querySelector("img")||{src:""},o=e.querySelectorAll(".gallerytext a"),i=e.querySelector(".gallerytext b"),n=i.children[0]?i.children[0]:i,r=o.length>1?o[1]:o[0],a=t.src.split("/").slice(0,-1),s=a.concat(`2000px-${a[a.length-1]}`).join("/"),_=n.innerText||"",c=n.href,u=r.innerText||"",p=r.href;return{src:`https://upload.wikimedia.org${s.split("//upload.wikimedia.org").pop()}`,title:_,author:u,titleLink:c?`https://wikipedia.org/wiki${c.split("/wiki").pop()}`:"",authorLink:p?`https://wikipedia.org/wiki${p.split("/wiki").pop()}`:"",provider:"Wikipedia",providerLink:"https://wikipedia.org",blob:void 0,timestamp:void 0}})}(t);return console.log(o.map(function({src:e}){return e})),n.dispatch({type:"ADD_ARTOBJECTS",artObjects:{key:"wikipedia",artObjects:o}}),o}}();if(t)return function(e){const[t]=e.splice(Math.floor(Math.random()*e.length),1)||[];return n.dispatch({type:"ADD_ARTOBJECTS",artObjects:{key:"wikipedia",artObjects:e}}),t}(t)}},s="https://www.rijksmuseum.nl/api/en/collection?format=json&ps=30&imgonly=True&type=painting&key=1KfM6MpD";const _={randomArtObject:async function(){const t=await async function(){const t=await e.get("artObjects","rijks");if(t&&t.artObjects.length>0)return t.artObjects;{const e=parseInt(localStorage.getItem("rijks_page")||1,10),[t,o]=await async function(e){try{const t=await r(`${s}&p=${e}`);return t?[void 0,(await t.json()).artObjects]:[!0]}catch(e){return console.error(e),[!0]}}(e);if(t)return;const i=o.filter(function(e){return null!==e.webImage&&void 0!==e.webImage}).map(function(e){return{src:e.webImage.url,title:e.title,author:e.principalOrFirstMaker,provider:"Rijksmuseum",titleLink:e.links.web,providerLink:"https://www.rijksmuseum.nl/en",blob:void 0,timestamp:void 0}});return n.dispatch({type:"ADD_ARTOBJECTS",artObjects:{key:"rijks",artObjects:i}}),localStorage.setItem("rijks_page",e+1),i}}();if(t)return function(e){const[t]=e.splice(Math.floor(Math.random()*e.length),1)||[];return n.dispatch({type:"ADD_ARTOBJECTS",artObjects:{key:"rijks",artObjects:e}}),t}(t)}},c=["https://upload.wikimedia.org/wikipedia/commons/thumb/9/9c/John_William_Waterhouse_-_Echo_and_Narcissus_-_Google_Art_Project.jpg/2000px-John_William_Waterhouse_-_Echo_and_Narcissus_-_Google_Art_Project.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/Hugo_van_der_Goes_-_The_Fall_of_Man_and_The_Lamentation_-_Google_Art_Project.jpg/2000px-Hugo_van_der_Goes_-_The_Fall_of_Man_and_The_Lamentation_-_Google_Art_Project.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Antonio_Allegri%2C_called_Correggio_-_Jupiter_and_Io_-_Google_Art_Project.jpg/2000px-Antonio_Allegri%2C_called_Correggio_-_Jupiter_and_Io_-_Google_Art_Project.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Angelo_Bronzino_-_Venus%2C_Cupid%2C_Folly_and_Time_-_National_Gallery%2C_London.jpg/2000px-Angelo_Bronzino_-_Venus%2C_Cupid%2C_Folly_and_Time_-_National_Gallery%2C_London.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Cornelis_Cornelisz._van_Haarlem_-_The_Fall_of_the_Titans_-_Google_Art_Project.jpg/2000px-Cornelis_Cornelisz._van_Haarlem_-_The_Fall_of_the_Titans_-_Google_Art_Project.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/f/f0/Venus_Consoling_Love%2C_Fran%C3%A7ois_Boucher%2C_1751.jpg/2000px-Venus_Consoling_Love%2C_Fran%C3%A7ois_Boucher%2C_1751.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/c/cd/Sarah_Goodridge_Beauty_Revealed_The_Metropolitan_Museum_of_Art.jpg/2000px-Sarah_Goodridge_Beauty_Revealed_The_Metropolitan_Museum_of_Art.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/1/1d/Piero_di_Cosimo_-_Portrait_de_femme_dit_de_Simonetta_Vespucci_-_Google_Art_Project.jpg/2000px-Piero_di_Cosimo_-_Portrait_de_femme_dit_de_Simonetta_Vespucci_-_Google_Art_Project.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Paul_Chabas_September_Morn_The_Metropolitan_Museum_of_Art.jpg/2000px-Paul_Chabas_September_Morn_The_Metropolitan_Museum_of_Art.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/f/f0/Venus_Consoling_Love%2C_François_Boucher%2C_1751.jpg/2000px-Venus_Consoling_Love%2C_François_Boucher%2C_1751.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/Giorgione_-_Sleeping_Venus_-_Google_Art_Project_2.jpg/2000px-Giorgione_-_Sleeping_Venus_-_Google_Art_Project_2.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/b/b5/Baudry_paul_the_wave_and_the_pearl.jpg/2000px-Baudry_paul_the_wave_and_the_pearl.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Edouard_Manet_-_Olympia_-_Google_Art_Project_3.jpg/2000px-Edouard_Manet_-_Olympia_-_Google_Art_Project_3.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/7/7c/RokebyVenus.jpg/2000px-RokebyVenus.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Goya_Maja_naga2.jpg/2000px-Goya_Maja_naga2.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/William-Adolphe_Bouguereau_%281825-1905%29_-_The_Wave_%281896%29.jpg/2000px-William-Adolphe_Bouguereau_%281825-1905%29_-_The_Wave_%281896%29.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Fouquet_Madonna.jpg/2000px-Fouquet_Madonna.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Angelo_Bronzino_-_Venus%2C_Cupid%2C_Folly_and_Time_-_National_Gallery%2C_London.jpg/2000px-Angelo_Bronzino_-_Venus%2C_Cupid%2C_Folly_and_Time_-_National_Gallery%2C_London.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Pierre-Auguste_Renoir%2C_French_-_The_Large_Bathers_-_Google_Art_Project.jpg/2000px-Pierre-Auguste_Renoir%2C_French_-_The_Large_Bathers_-_Google_Art_Project.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/Peter_Paul_Rubens_-_The_Birth_of_the_Milky_Way%2C_1636-1637.jpg/2000px-Peter_Paul_Rubens_-_The_Birth_of_the_Milky_Way%2C_1636-1637.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Edvard_Munch_-_Madonna_-_Google_Art_Project.jpg/2000px-Edvard_Munch_-_Madonna_-_Google_Art_Project.jpg"],u=72e5;async function p(){let t,o;const n=(t=await e.get("images","current"))&&t.timestamp<Date.now()-u;t&&!n||((o=await e.get("images","next"))?(t=o,await e.remove("images","next")):t=await l(),console.log(t)),i.dispatch({type:"ADD_ARTOBJECT",artObject:{...t,id:"current"}}),(o=await e.get("images","next"))||(o=await l(),i.dispatch({type:"ADD_ARTOBJECT",artObject:{...o,id:"next"}}))}async function l(){const e=await function(){switch(Math.floor(2*Math.random())){case 0:return a.randomArtObject();case 1:return _.randomArtObject()}}();if(!e)return l();if(console.log(e.src,c.includes(e.src)),c.includes(e.src))return l();if(e.blob)return e.timestamp=Date.now(),e;const[t,o]=await async function(e){try{const t=await r(e.replace("chrome-extension://","https://"));return t?[void 0,await t.blob()]:[!0]}catch(e){return console.error(e),[!0]}}(e.src);return t?l():(e.blob=o,e.timestamp=Date.now(),e)}function d(e){if("next"===e.id)return;const t=document.getElementById("background"),o=new window.Image,n=URL.createObjectURL(e.blob);o.onload=function(){t.classList.toggle("portrait",o.naturalWidth<o.naturalHeight),t.style.backgroundImage=`url('${n}')`;const i=document.getElementById("title");i.textContent=e.title.length>50?`${e.title.slice(0,50)}...`:e.title,e.titleLink?(i.href=e.titleLink,i.style.pointerEvents="auto"):i.style.pointerEvents="none";const r=document.getElementById("author");r.textContent=e.author?`by ${e.author}`:"",e.authorLink?(r.href=e.authorLink,r.style.pointerEvents="auto"):r.style.pointerEvents="none";const a=document.getElementById("provider");a.textContent=`from ${e.provider}`,a.href=e.providerLink},o.src=n,i.unsubscribe(d)}let m=!1;const g=document.getElementById("btn-refresh");const h={addListeners:function(){i.subscribe(d),g.addEventListener("animationiteration",function(){m||g.classList.remove("active")}),g.addEventListener("click",async function(t){m||(m=!0,g.classList.add("active"),i.subscribe(d),await e.remove("images","current"),await p(),m=!1)})}};async function b(){localStorage.removeItem("rijks_page");try{await e.destroy("images")}catch(e){console.error(e)}try{await e.destroy("artObjects")}catch(e){console.error(e)}}!async function(){navigator.storage.persist(),await e.open("galeri",1,function(e){const{result:t}=e.target;t.objectStoreNames.contains("images")||t.createObjectStore("images",{keyPath:"id",autoIncrement:!0}),t.objectStoreNames.contains("artObjects")||t.createObjectStore("artObjects",{keyPath:"key",autoIncrement:!0})}),h.addListeners(),await p(),window.flush=b}();
